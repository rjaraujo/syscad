<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
 	xmlns:h="http://xmlns.jcp.org/jsf/html"
 	xmlns:f="http://xmlns.jcp.org/jsf/core"
 	xmlns:p="http://primefaces.org/ui"
 	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
 	template="WEB-INF/template/Layout.xhtml">
 	
<ui:define name="titulo">
	Cadastros
</ui:define>

<ui:define name="conteudo">
	<f:metadata>
		<f:viewAction action="#{gestaoUsuariosBean.todosUsuarios}" />
	</f:metadata>
	
	<h:form id="frm">
		<p:messages id="messages" />
	
		<p:toolbar id="toolbar">
			<f:facet name="left">
				<p:inputText id="termoPesquisa" placeholder="Digite aqui um termo para pesquisa..." 
					size="30" value="#{gestaoUsuariosBean.termoPesquisa}"/>
				
				<p:commandButton value="Pesquisar" icon="fa fa-search"
					actionListener="#{gestaoUsuariosBean.pesquisar}" update="usuariosDataTable messages"
					process="@this termoPesquisa"/>
				
				<span class="ui-separator">
	                <span class="ui-icon ui-icon-grip-dotted-vertical" />
	            </span>
	            
	            <p:commandButton value="Nova" icon="fa fa-plus"
	            	actionListener="#{gestaoUsuariosBean.prepararNovoUsuario}" 
	            	oncomplete="PF('usuarioDialogWidgetVar').show()"
	            	update="UsuarioDialog" process="@this">
	            	<p:resetInput target="UsuarioDialog" />	
            	</p:commandButton>
	            
				<span class="ui-separator">
	                <span class="ui-icon ui-icon-grip-dotted-vertical" />
	            </span>
	            
	            <p:commandButton title="Editar" icon="fa fa-edit" 
	            	disabled="#{not gestaoUsuariosBean.usuarioSeleciona}"
	            	actionListener="#{gestaoUsuariosBean.prepararEdicao}"
	            	oncomplete="PF('usuarioDialogWidgetVar').show()"
	            	update="UsuarioDialog" process="@this">
	            	<p:resetInput target="UsuarioDialog" />	
            	</p:commandButton>
	            
	            <p:commandButton title="Excluir" icon="fa fa-trash" 
	            	disabled="#{not gestaoUsuariosBean.usuarioSeleciona}"
	            	actionListener="#{gestaoUsuariosBean.excluir}"
	            	update="messages usuariosDataTable toolbar"
	            	process="@this">
	            	<p:confirm icon="ui-icon-alert" header="Confirmação de exclusão" 
	            		message="Tem certeza que deseja excluir este usuário" />	
            	</p:commandButton>
	            
				<span class="ui-separator">
	                <span class="ui-icon ui-icon-grip-dotted-vertical" />
	            </span>
	            
	            <p:commandButton title="Exportar para o Excel" icon="fa fa-file-excel-o"
	            	ajax="false">
	            	<p:dataExporter type="xls" target="usuariosDataTable" fileName="Usuarios" />
	            </p:commandButton>		
			</f:facet>
		</p:toolbar>
		
		<p:spacer height="20px" />
		
		<p:dataTable id="usuariosDataTable" value="#{gestaoUsuariosBean.listaUsuarios}"
			var="usuario" emptyMessage="Nenhuma informação a ser exibida"
			paginator="true" rows="10" paginatorPosition="bottom"
			selectionMode="single" selection="#{gestaoUsuariosBean.usuario}" rowKey="#{usuario.id}">
			
			<p:ajax event="rowSelect" update="frm:toolbar" />
			
			<p:ajax event="rowUnselect" update="frm:toolbar" />
			
			<p:column headerText="Razão social" sortBy="#{usuario.razaoSocial}">
				<h:outputText value="#{usuario.razaoSocial}" />
			</p:column>
			
			<p:column headerText="Nome fantasia">
				<h:outputText value="#{usuario.nomeFantasia}" />
			</p:column>
			
			<p:column headerText="Tipo usuario">
				<h:outputText value="#{usuario.tipo}" />
			</p:column>
			
			<p:column headerText="Ramo atividade">
				<h:outputText value="#{usuario.ramoAtividade.descricao}" />
			</p:column>
			
			<p:column headerText="Pelfil">
				<h:outputText value="#{usuario.perfil.descricao}" />
			</p:column>			
			
		</p:dataTable>
		
		<p:dialog id="UsuarioDialog" header="Nova usuario" widgetVar="usuarioDialogWidgetVar"
			modal="true" resizable="false" closeOnEscape="true">
			<p:messages id="usuarioMessages" />
			
			<p:defaultCommand target="salvarCommandButton" scope="UsuarioDialog" />
			
			<h:panelGrid id="usuarioPanelGrid" columns="2"
				rendered="#{gestaoUsuariosBean.usuario ne null}">				
				<p:outputLabel value="Nome: " for="nome" />
				<p:inputText id="nome" size="80" maxlength="80" 
					value="#{gestaoUsuariosBean.usuario.nome}"/>
				
				<p:outputLabel value="Email " for="email" />
				<p:inputText id="email" size="80" maxlength="80" 
					value="#{gestaoUsuariosBean.usuario.email}"/>	
				
				<p:outputLabel value="CPF " for="cpf" />
				<p:inputMask id="cpf" mask="999.999.999-99" size="11" maxlength="11"
					value="#{gestaoUsuariosBean.usuario.cpf}"/>
				
				<p:outputLabel value="Data Cadastro: " for="dataCadastro" />
				<p:calendar id="dataCadastro" pattern="dd/MM/yyyy" size="30" 
					value="#{gestaoUsuariosBean.usuario.dataCadastro}"/>
				
				<p:outputLabel value="Perfil: " for="perfil" />
				<p:autoComplete id="perfil" size="80" 
					value="#{gestaoUsuariosBean.usuario.perfil}"
					completeMethod="#{gestaoUsuariosBean.completarPerfil}" 
					converter="#{gestaoUsuariosBean.perfilConverter}"
					var="perfil"
					itemLabel="#{perfil.descricao}" itemValue="#{perfil}"/>
					
				
								
				<h:outputLabel />
				<p:commandButton id="salvarCommandButton" value="Salvar" actionListener="#{gestaoUsuariosBean.salvar}"
					update="usuarioPanelGrid usuarioMessages"
					oncomplete="if (!args.validationFailed) PF('usuarioDialogWidgetVar').hide()" process="UsuarioDialog"/>
			</h:panelGrid>
		</p:dialog>
	</h:form>
</ui:define>

</ui:composition>